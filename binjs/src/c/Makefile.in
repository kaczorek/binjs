#
# Start of a Makefile
#
# Compile with gcc and link with g++ so the C++ libraries get resolved properly
#
CC=gcc
CFLAGS=-I. `pkg-config --cflags glib-2.0`
DEPS = libpreparser.h
EXT_OBJS=../v8/bashexec.o ../v8/file.o ../v8/util.o ../v8/term.o ../v8/librunjs.o ../v8/runtime.o
GLIBS=`pkg-config --libs glib-2.0`
LIBS=-lv8

%.o: %.c $(DEPS)
	$(CC) -Wall -c -o $@ $< $(CFLAGS)

all: binjs_preparser binjs

binjs_preparser : binjs_preparser.c libpreparser.o
	gcc -Wall libpreparser.o binjs_preparser.c $(CFLAGS) -o binjs_preparser $(GLIBS)

binjs : binjs.o libpreparser.o $(EXT_OBJS) ../../contrib/libbash.a
	g++ -Wall binjs.o libpreparser.o ../../contrib/libbash.a $(EXT_OBJS) $(CFLAGS)-o binjs $(LIBS) $(GLIBS) -L../../contrib


.PHONY: clean

clean:
	rm -f *.o binjs binjs_preparser
