#
# Makefile for v8 modifications
#
# TODO some of this config should come from autoconf
#

CC=g++
CONTLINKS=-lv8 -lpthread
CONTINCS=-I../../contrib/include
CONTLIBS=-L../../contrib
DEPS = file.h util.h term.h bashexec.h runtime.h
OBJS = file.o util.o term.o bashexec.o runtime.o
GINCS=`pkg-config --cflags glib-2.0`
GLIBS=`pkg-config --libs glib-2.0`

all : librunjs.so runjs

runjs : runjs.c $(OBJS)
	g++ -Wall -fPIC runjs.c librunjs.o $(OBJS) $(CONTLINKS) $(CONTINCS) $(CONTLIBS) -lbash \
		-o runjs
		
librunjs.so : librunjs.cpp $(OBJS)
	g++ -Wall -fPIC -c librunjs.cpp $(CONTINCS) $(GINCS) 
	g++ -Wall -fPIC -shared librunjs.cpp $(OBJS) $(CONTLINKS) $(GINCS) $(CONTINCS) $(CONTLIBS) -lbash \
		-o librunjs.so.1
	rm -f librunjs.so
	ln -s librunjs.so.1 librunjs.so

%.o: %.cpp $(DEPS) librunjs.h
	$(CC) -Wall -fPIC -c -o $@ $< $(CONTINCS)

.PHONY: clean

clean:
	rm -f *.o runjs librunjs.so.1 librunjs.so librunjs.o
