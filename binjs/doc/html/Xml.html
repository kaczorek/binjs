<!DOCTYPE html>
<html>
  <head>
	<title>Xml.md</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link href="style.css" rel="stylesheet"/>
	<link href="binjs_16x16.png" rel="shortcut icon"/>
  </head>
	<body id="pw-body">
		<div id="container">
			<div id="header"><span class="title">/bin/js documentation</span></div>
			<div id="content">
			<div id="menu">
				<ul>
					<li><a href="./index.html">Doc index</a></li>
					<li><a href="../api/html/index.html">API index</a></li>
					<li><a href="https://github.com/teknopaul/binjs">github project</a></li>
					<li><a href="http://teknopaul.github.com/binjs/">github page</a></li>
				</ul>
			</div>
			<div id="main">
				<img src="binjs_64x64.png" id="logo"/>
<h1>Xml Support</h1>

<p>Modifying XML files in scripts is fiddly with only Linux tools like awk and sed at your disposal so /bin/js comes with an XML parser built in, it is lifted from nodejs code with a couple of changes to make it more fitting for synchronous scripts.</p>

<h2>Usage</h2>

<h3>Dom</h3>

<p>The following header is needed to import the xml libraries.  This imports both <code>Sax</code> and <code>Dom</code> parsers, Dom uses Sax.</p>

<pre><code>binjs_import("~lib/Xml.js");
</code></pre>

<p>To parse a document to a dom first read it as a JavaScript String then pass it to the Dom parser.</p>

<pre><code>var text = new File("./doc.xml").read();
var parser = new Dom();
var rootElement = parser.parse(text);
</code></pre>

<p>A heirarchy of objects is returned, inspect an example with <code>JSON.stringify()</code> to understand how to navigate the Dom once parsed.</p>

<pre><code>$.println(JSON.stringify(rootElement));
</code></pre>

<p>The object can be modified and written back out with <code>dom.toXml()</code></p>

<h3>Sax</h3>

<p>To parse with Sax the same import is needed, or you can just import <code>Sax.js</code>.</p>

<pre><code>binjs_import("~lib/Xml.js");
</code></pre>

<p>or </p>

<pre><code>binjs_import("~lib/Sax.js");
</code></pre>

<p>Parsing with Sax requires passing callback functions which is nodejs's style of working. The Sax nodejs parser can be used as synchronous code by passing the whole XML document as one string to the <code>write</code> method, as follows.</p>

<pre><code>var parser = new Sax().parser();
var text = new File("./doc.xml").read();

var xmlVer = "";
parser.onopentag = function (node) {
    if (node.name == "abc") 
      xmlVer = node.attributes["version"];
};

parser.write(text).close();

$.println("Xml version is: " + xmlVer);
</code></pre>

				<br/><br/>
			</div>
		</div>
		<div id="footer"> by teknopaul </div>
	</div>
	<br/><br/>
  </body>
</html>
