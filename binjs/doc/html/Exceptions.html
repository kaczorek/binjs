<!DOCTYPE html>
<html>
  <head>
	<title>Exceptions.md</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link href="style.css" rel="stylesheet"/>
	<link href="binjs_16x16.png" rel="shortcut icon"/>
  </head>
	<body id="pw-body">
		<div id="container">
			<div id="header"><span class="title">/bin/js documentation</span></div>
			<div id="content">
			<div id="menu">
				<ul>
					<li><a href="./index.html">Doc index</a></li>
					<li><a href="../api/html/index.html">API index</a></li>
					<li><a href="https://github.com/teknopaul/binjs">github project</a></li>
					<li><a href="http://teknopaul.github.com/binjs/">github page</a></li>
				</ul>
			</div>
			<div id="main">
				<img src="binjs_64x64.png" id="logo"/>
<h1>Exceptions</h1>

<h2>throw</h2>

<p>Bash has pretty limited exception handling and JavaScript is faily good with support for <code>try</code> , <code>catch</code> and <code>finally</code>.</p>

<p>Generally to trap an error in a bash script the idiom is to OR an exit commant to the command line so that the script is interrupted if the line being executed fails.</p>

<pre><code>./callScript.sh || exit 3
</code></pre>

<p>This enables a script to bomb out before it does any damage if there is an unexpected error, but its not very elegant.  JavaScript code can wrap a block of code with a try/catch block and exceptions can be thrown. /bin/js provides a mechanism by which bash commands can integrate error handling with JavaScript.</p>

<pre><code>./callScript.sh || throw "script failed"
</code></pre>

<p>Throw is a bash builtin that has been added to facilitate integrating JavaScript and bash error handling.  The syntax is similar to the exit idiom but when the throw is called a JavaScript <code>Error</code> object is created with the String as its message and can be caught later in the script.  Notice that when the bash builtin <code>throw</code> is called a String is provided and the builtin creates the <code>Error</code> object, but when JavaScript exceptions are thrown the script should specify the <code>Error</code> explicitly.</p>

<pre><code>try {

    ...

    ./callScript.sh || throw "script failed"

    ...

    logevent 23 || throw "logging failed"

    ...

    if (jsError) { 
        throw new Error("JavaScript error");
    }

}
catch(error) { // object caught is a JavaScript Error
    $.error(1,"Exception caught", error.message);
}
</code></pre>

<p>You can throw JavaScript Strings or other Objects as you might in any JavaScript code but this makes integrating exception handlers with bash exceptions more difficult since there is, currently, no way to make the bash builtin throw anything other than an Object containing a String message.</p>

<p>N.B. the throw builtin can only be used in a bash statement at the end of the command (after || ), because the preparser determins <code>throw</code> to be JavaScript at the start of a line.</p>

<h2>errno</h2>

<p>The typical error handling mechanisn for a bash script is to check the <code>$?</code> variable, which is the last exit value of a command run by bash.  Since <code>if</code> and <code>switch</code> statements are handled by JavaScript in /bin/js the <code>$?</code> value is copied to the global <code>errno</code> variable which provides a code pattern that should be familiar to C developers, where <code>errno</code> is common.</p>

<pre><code>./someScript.sh

switch(errno) {
    case 0 : {
        echo all OK
    }
    case 1 : {
        throw new Error("File not found");
    }
    case 2 : {
        throw new
    }
}
</code></pre>

				<br/><br/>
			</div>
		</div>
		<div id="footer"> by teknopaul </div>
	</div>
	<br/><br/>
  </body>
</html>
